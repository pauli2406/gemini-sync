version: 1

exempt_sources:
  - "tests/**"
  - ".github/**"
  - ".gitignore"
  - "LICENSE"
  - "CONTRIBUTING.md"

rules:
  - name: runtime_and_api
    sources:
      - "gemini_sync_bridge/**"
    docs_any_of:
      - "README.md"
      - "docs/start-here.mdx"
      - "docs/tutorials/getting-started-local.mdx"
      - "docs/tutorials/gcp-onboarding.mdx"
      - "docs/how-to/migrate-custom-connectors.mdx"
      - "docs/how-to/operate-runs.mdx"
      - "docs/concepts/architecture.mdx"
      - "docs/reference/api-reference.mdx"

  - name: connector_contract
    sources:
      - "connectors/**"
      - "schemas/connector.schema.json"
      - "schemas/connector.docs-meta.yaml"
    docs_any_of:
      - "README.md"
      - "docs/how-to/connector-authoring.mdx"
      - "docs/how-to/connectors/sql-pull.mdx"
      - "docs/how-to/connectors/rest-pull.mdx"
      - "docs/how-to/connectors/rest-push.mdx"
      - "docs/how-to/connectors/file-pull.mdx"
      - "docs/reference/providers/postgres.mdx"
      - "docs/reference/providers/mysql.mdx"
      - "docs/reference/providers/mssql.mdx"
      - "docs/reference/providers/oracle.mdx"
      - "docs/reference/providers/http.mdx"
      - "docs/reference/providers/file.mdx"
      - "docs/reference/providers/future.mdx"
      - "docs/reference/connector-fields.md"
      - "docs/how-to/migrate-custom-connectors.mdx"
      - "docs/tutorials/gcp-onboarding.mdx"

  - name: orchestrator_and_deploy
    sources:
      - "flows/**"
      - "infra/**"
      - "docker-compose.yml"
      - "Dockerfile"
    docs_any_of:
      - "README.md"
      - "docs/tutorials/getting-started-local.mdx"
      - "docs/concepts/architecture.mdx"
      - "docs/how-to/operate-runs.mdx"
      - "docs/tutorials/gcp-onboarding.mdx"

  - name: governance_and_quality
    sources:
      - "scripts/check_*.py"
      - "scripts/export_openapi.py"
      - "scripts/export_connector_reference.py"
      - "scripts/generate_slo_report.py"
      - "scripts/replay_run_artifacts.py"
      - ".agent/**"
      - "schemas/agent-task.schema.json"
      - "AGENTS.md"
      - "evals/**"
    docs_any_of:
      - "README.md"
      - "AGENTS.md"
      - "docs/start-here.mdx"
      - "docs/how-to/migrate-custom-connectors.mdx"
      - "docs/how-to/connector-authoring.mdx"
      - "docs/reference/connector-fields.md"
      - "docs/contributing/testing-ci.mdx"
      - "docs/roadmap.mdx"
      - "docs/concepts/reliability-and-slos.mdx"
      - "docs/reference/api-reference.mdx"
      - "docs/how-to/troubleshooting.mdx"

  - name: docs_site
    sources:
      - "website/**"
    docs_any_of:
      - "README.md"
      - "docs/start-here.mdx"
      - "docs/tutorials/getting-started-local.mdx"
      - "docs/tutorials/gcp-onboarding.mdx"
      - "docs/how-to/connector-authoring.mdx"
      - "docs/how-to/connectors/sql-pull.mdx"
      - "docs/how-to/connectors/rest-pull.mdx"
      - "docs/how-to/connectors/rest-push.mdx"
      - "docs/how-to/connectors/file-pull.mdx"
      - "docs/reference/providers/postgres.mdx"
      - "docs/reference/providers/mysql.mdx"
      - "docs/reference/providers/mssql.mdx"
      - "docs/reference/providers/oracle.mdx"
      - "docs/reference/providers/http.mdx"
      - "docs/reference/providers/file.mdx"
      - "docs/reference/providers/future.mdx"
      - "docs/reference/connector-fields.md"
      - "docs/how-to/operate-runs.mdx"
      - "docs/concepts/architecture.mdx"
      - "docs/reference/api-reference.mdx"
      - "docs/how-to/troubleshooting.mdx"

consistency:
  required_files:
    - "README.md"
    - "docs/concepts/architecture.mdx"
    - "docs/how-to/operate-runs.mdx"
  required_tokens:
    - "gemini-sync-bridge run --connector"
    - "gemini-sync-bridge serve --host 0.0.0.0 --port 8080"
    - "python scripts/check_tdd_guardrails.py"
    - "python scripts/check_docs_drift.py"
